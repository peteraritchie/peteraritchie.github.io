

<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Peter Ritchie&#x27;s Blog - Who&#x2019;s Referencing Whom?</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/sass/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="/assets/sass/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="/assets/sass/ie8.css" /><![endif]-->
        

	</head>
	<body>

		<!-- Page Wrapper -->
			<div id="page-wrapper">
				
				<!-- Header -->
				<header id="header">
					<h1><a href="/">Peter Ritchie&#x27;s Blog</a></h1>
					<nav>
						<a href="#menu">Menu</a>
					</nav>
				</header>

				<!-- Menu -->
				<nav id="menu">
					<div class="inner">
						<h2>Menu</h2>
						<ul class="links">
							        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>

						</ul>
						<a href="#" class="close">Close</a>
					</div>
				</nav>


    
<section id="banner">
  <div class="inner">
    <h2>Who&#x2019;s Referencing Whom?</h2>
            <p><em>Published on Friday, October 12, 2007</em></p>
                    <a role="button" href="/tags/NET-20" class="button small">.NET 2.0</a>
                <a role="button" href="/tags/NET-Development" class="button small">.NET Development</a>
                <a role="button" href="/tags/Debugging" class="button small">Debugging</a>
                <a role="button" href="/tags/msmvps" class="button small">msmvps</a>
                <a role="button" href="/tags/October-2007" class="button small">October 2007</a>
                <a role="button" href="/tags/Visual-Studio-2005" class="button small">Visual Studio 2005</a>
  </div>
</section>

				<!-- Main -->
				<section id="wrapper">
					<section class="wrapper style2">
						<div class="inner">
							

<p><a href="http://blogs.msmvps.com/peterritchie/2007/10/12/who-s-referencing-whom/" title="Permalink to Who’s Referencing Whom?">Source</a></p>
<h1 id="whos-referencing-whom">Who’s Referencing Whom?</h1>
<p>When developing any sort of application, debugging in inevitable. Sometimes, part of that debugging means trying to figure out why objects haven't been collected and therefore figuring out what object is referencing the object that has yet to be collected.</p>
<p>There's many reasons why you'd want to find out what object is referencing, like suspected memory &quot;leaks&quot;.</p>
<p>With Visual Studio (and MDbg) you can use a tool called SOS (or SonOfStrike). This is included in the .NET installation. To use SOS you first need to enable unmanaged debugging in your project (ProjectProperties, Debug tab, check &quot;Enable unmanaged code debugging&quot; in the &quot;Enable Debuggers&quot; section). Once unmanaged debugging is enabled you can then debug your application. To use SOS once debugging, you need to load the extension (every time a new debugging session is started). Once a breakpoint has been hit, open the Immediate Window and type .load sos which should result in the following:</p>
<blockquote class="blockquote">
<p>.load sos<br />
extension C:WINDOWSMicrosoft.NETFrameworkv2.0.50727sos.dll loaded</p>
</blockquote>
<p>With SOS loaded, you can find out if any objects of a particular type are currently in memory with the &quot;dumpheap -type&quot; command, for example:</p>
<blockquote class="blockquote">
<p>!dumpheap -type NamespaceName.TypeName<br />
Address MT Size<br />
012b2db8 009159c4 328<br />
total 1 objects<br />
Statistics:<br />
MT Count TotalSize Class Name<br />
009159c4 1 328 NamespaceName.TypeName<br />
Total 1 objects</p>
</blockquote>
<p>This lists all objects of the requested type, their address, their MethodTable (MT), and the count of each object per MethodTable.</p>
<p>Once you have the object's address you can then find out what objects are referencing that particular instance. This is done with the gcroot command:</p>
<blockquote class="blockquote">
<p>!gcroot 012b2db8<br />
Note: Roots found on stacks may be false positives. Run &quot;!help gcroot&quot; for<br />
more info.<br />
Error during command: warning! Extension is using a feature which Visual Studio does not implement.</p>
</blockquote>
<p>Scan Thread 4756 OSTHread 1294<br />
ESP:12f0dc:Root:012b2db8(WindowsApplication1.Form1)-&gt;<br />
012bb104(WindowsApplication1.Form2)-&gt;<br />
012bb254(System.Collections.Generic.List`1[[NamespaceName.TypeName, WindowsApplication1]])-&gt;<br />
012bc178(System.Object[])-&gt;<br />
012bc16c(NamespaceName.TypeName)<br />
Scan Thread 3496 OSTHread da8</p>
<p>In this particular example, the above tells us that our object (012bc16c(NamespaceName.TypeName)) is referenced by an Object array (012bc178(System.Object[])), which is referenced by a <code>List&lt;T&gt;</code> object (012bb254(System.Collections.Generic.List`1[[NamespaceName.TypeName, WindowsApplication1]])), which is referenced by Form2 (012bb104(WindowsApplication1.Form2)), which is referenced by a Form1 object(ESP:12f0dc:Root:012b2db8(WindowsApplication1.Form1)).</p>


<div id="disqus_thread"></div>  
<!--
    'Who%E2%80%99s-Referencing-Whom%3F'
    'Who&#x2019;s Referencing Whom?'
    'http://blog.peterritchie.com/posts/Who%E2%80%99s-Referencing-Whom%3F'
-->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    var fromJekyllDate = new Date('Wed Feb 01 2022');
    var publishedDate = new Date('10/12/2007');
    console.info('Who%E2%80%99s-Referencing-Whom%3F');

    var disqus_identifier = '';
    var disqus_shortname = 'peterritchiesblog'; // required: replace example with your forum shortname
    var disqus_title = 'Who&#x2019;s Referencing Whom?';
    var disqus_url = 'http://blog.peterritchie.com/posts/Who%E2%80%99s-Referencing-Whom%3F';

    if(publishedDate < fromJekyllDate)
    {
        disqus_url = disqus_url.replace('/posts', '');
        disqus_url = disqus_url + '/';
    }
    else
    {
        //var disqus_identifier = 'Who%E2%80%99s-Referencing-Whom%3F';
    }
    console.info(disqus_identifier);

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
						</div>
					</section>
				
				</section>
				
				<!-- Footer -->
                <footer id="footer">
                    <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © Peter Ritchie&#x27;s Blog 2022
                        <br />
                            <a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by "Wyam"</a></strong>
                    </p>
                </div>
        </div>
</div>
                </footer>
			</div>

		<!-- Scripts -->
			<script src="/assets/js/skel.min.js"></script>
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/util.js"></script>
            <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
            <script src="/assets/js/main.js"></script>

	</body>

</html>