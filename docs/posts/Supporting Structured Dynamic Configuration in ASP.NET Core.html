

<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Peter Ritchie&#x27;s Blog - Supporting Structured Dynamic Configuration in ASP.NET Core appsettings</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/assets/sass/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="/assets/sass/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="/assets/sass/ie8.css" /><![endif]-->
        

	</head>
	<body>

		<!-- Page Wrapper -->
			<div id="page-wrapper">
				
				<!-- Header -->
				<header id="header">
					<h1><a href="/">Peter Ritchie&#x27;s Blog</a></h1>
					<nav>
						<a href="#menu">Menu</a>
					</nav>
				</header>

				<!-- Menu -->
				<nav id="menu">
					<div class="inner">
						<h2>Menu</h2>
						<ul class="links">
							        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>

						</ul>
						<a href="#" class="close">Close</a>
					</div>
				</nav>


    
<section id="banner">
  <div class="inner">
    <h2>Supporting Structured Dynamic Configuration in ASP.NET Core appsettings</h2>
            <p><em>Published on Friday, September 21, 2018</em></p>
                    <a role="button" href="/tags/September-2018" class="button small">September 2018</a>
  </div>
</section>

				<!-- Main -->
				<section id="wrapper">
					<section class="wrapper style2">
						<div class="inner">
							

<h2 id="configuration-in-asp.net-core-a-brief-retrospection">Configuration in ASP.NET Core, a Brief Retrospection</h2>
<p>Let's look at a couple of isolated examples of ASP.NET Core configuration, options, and appsettings to set a scope:</p>
<p>ASP.NET Core is very flexible and powerful with regard to configuration and options.  One of the features is the ability to bind configuration (textual information) to a concrete type and support strongly-typed configuration.  For example, with the following appsettings:</p>
<pre><code class="language-JSON">{
  &quot;option1&quot;: &quot;value1_from_json&quot;,
  &quot;option2&quot;: -1,
}
</code></pre>
<p>A class can be created to structurally contain that data:</p>
<pre><code class="language-csharp">public class MyOptions
{
	public string Option1 { get; set; }
	public int Option2 { get; set; } = 5;
}
</code></pre>
<p>And in your startup, you can either directly bind the data to an instance of the class:</p>
<pre><code class="language-csharp">var myOptions = new MyOptions();
Configuration.Bind(myOptions);
</code></pre>
<p>or indirectly bind the data via the <em>Options Pattern</em>:</p>
<pre><code class="language-csharp">services.Configure&lt;MyOptions&gt;(Configuration);
</code></pre>
<p>...to be injected into other services that have a constructor parameter of type <code>IOptions&lt;MyOptions&gt;</code>:</p>
<pre><code class="language-csharp">	public ValuesController(IOptions&lt;MyOptions&gt; myOptions)
	{
		//...
	}
</code></pre>
<h2 id="what-is-dynamic-configuration">What is <em>Dynamic Configuration</em>?</h2>
<p>Dynamic configuration is really about how the configuration data is handled.  The structure of the configuration is the same, but with a looser &quot;schema&quot;.</p>
<p>Given the following JSON:</p>
<pre><code class="language-json">{
  &quot;ConnectionStrings&quot;:
  {
    &quot;BloggingDatabase&quot;: &quot;Server=(localdb)\\mssqllocaldb;Database=EFGetStarted.ConsoleApp.NewDb;Trusted_Connection=True;&quot;
  }
}
</code></pre>
<p>...and much like above, you <em>can</em> bind it to classes like this:</p>
<pre><code class="language-csharp">public class ConnectionStrings
{
	public string BloggingDatabase {get;set;}
}

public class MyConfiguration
{
	public ConnectionStrings ConnectionStrings {get;set;}
}
</code></pre>
<p>With familiar but specific binding code like this:</p>
<pre><code class="language-csharp">var myConfiguration = new MyConfiguration();
Configuration.Bind(myConfiguration)
</code></pre>
<p>or:</p>
<pre><code class="language-csharp">services.Configure&lt;MyConfiguration&gt;(Configuration);
// ...and use the type IOptions&lt;MyConfiguration&gt; in constructor
// parameters for the options to be injected.
</code></pre>
<p>For that <code>Bind</code> or <code>Configure</code> (which does the <code>Bind</code> for you) to work, the <code>ConnectionStrngs</code> class requires the <code>BloggingDatabase</code> property so it can match the name in the config.</p>
<p>The &quot;dynamic&quot; part is when you want to support user-supplied key names and/or variable quantities of key/value pairs. If a user added another connection string, we'd be unable to support it without a redeployment, for example another connection string in the config:</p>
<pre><code class="language-json">{
  &quot;ConnectionStrings&quot;:
  {
    &quot;BloggingDatabase&quot;: &quot;Server=(localdb)\\mssqllocaldb;Database=EFGetStarted.ConsoleApp.NewDb;Trusted_Connection=True;&quot;,
    &quot;AuditingDatabase&quot;: &quot;Server=(localdb)\\mssqllocaldb;Database=EFGetStarted.ConsoleApp.AuditDb;Trusted_Connection=True;&quot;
  }
}
</code></pre>
<p>We'd have to update our ConnectionStrings class to support the new connection string value.  You can imagine that connection strings are unique to each app, so there's no way to create one class to handle every scenario.</p>
<p>But, in the end, ASP.NET Core configuration/options are really just a set of key/value pairs, you <strong>can support user-supplied names like this using a dictionary</strong>.  For example:</p>
<pre><code class="language-csharp">public class MyConfiguration
{
	public Dictionary&lt;string, string&gt; ConnectionStrings {get;set;}
}
</code></pre>
<p>And rather than <code>myConfiguration.ConnectionStrings.BloggingDatabase</code> to access the value, it would be <code>myConfiguration.ConnectionStrings[&quot;BloggingDatabase&quot;]</code>.</p>
<p>Binding would be the same:</p>
<pre><code class="language-csharp">var myConfiguration = new MyConfiguration();
Configuration.Bind(myConfiguration)
</code></pre>
<p>or:</p>
<pre><code class="language-csharp">services.Configure&lt;MyConfiguration&gt;(Configuration);
</code></pre>
<p>This technique also supports the ability to more easily reference keys as values of other configuration keys.  Let's say that I want to have my connection strings in one place and configure other things to use those connection string (e.g. shared).  You might consider a JSON config that looks like this:</p>
<pre><code class="language-json">{
  &quot;ConnectionStrings&quot;: {
    &quot;BloggingDatabase&quot;: &quot;Server=(localdb)\\mssqllocaldb;Database=EFGetStarted.ConsoleApp.NewDb;Trusted_Connection=True;&quot;,
    &quot;AuditingDatabase&quot;: &quot;Server=(localdb)\\mssqllocaldb;Database=EFGetStarted.ConsoleApp.AuditDb;Trusted_Connection=True;&quot;
  },
  &quot;Repositories&quot;: {
    &quot;BlogEntryController&quot; : {
      &quot;Type&quot;: &quot;Infrastructure.Persistence.SqlServer.SqlServerRepository, aipss, Version=1.7.1.0, Culture=neutral, PublicKeyToken=80e841a370b13835&quot;,
      &quot;Argument&quot;: &quot;BloggingDatabase&quot;
    },
    &quot;BlogEntryControllerAudit&quot; : {
      &quot;Type&quot;: &quot;Infrastructure.Persistence.SqlServer.SqlServerRepository, aipss, Version=1.7.1.0, Culture=neutral, PublicKeyToken=80e841a370b13835&quot;,
      &quot;Argument&quot;: &quot;AuditDatabase&quot;
    },
    &quot;AdminControllerAudit&quot; : {
      &quot;Type&quot;: &quot;Infrastructure.Persistence.SqlServer.SqlServerRepository, aipss, Version=1.7.1.0, Culture=neutral, PublicKeyToken=80e841a370b13835&quot;,
      &quot;Argument&quot;: &quot;AuditDatabase&quot;
    }
  }
}
</code></pre>
<h1 id="references">References</h1>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/magazine/mt632279.aspx">MSDN Magazine - Essential .NET - Configuration in .NET Core</a></li>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/options?view=aspnetcore-2.1">Microsoft Docs - Options pattern in ASP.NET Core</a></li>
</ul>


<div id="disqus_thread"></div>  
<!--
    'Supporting Structured Dynamic Configuration in ASP.NET Core'
    'Supporting Structured Dynamic Configuration in ASP.NET Core appsettings'
    'http://blog.peterritchie.com/posts/Supporting%20Structured%20Dynamic%20Configuration%20in%20ASP.NET%20Core'
-->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    var fromJekyllDate = new Date('Wed Feb 01 2022');
    var publishedDate = new Date('9/21/2018');
    console.info('Supporting Structured Dynamic Configuration in ASP.NET Core');

    var disqus_identifier = '';
    var disqus_shortname = 'peterritchiesblog'; // required: replace example with your forum shortname
    var disqus_title = 'Supporting Structured Dynamic Configuration in ASP.NET Core appsettings';
    var disqus_url = 'http://blog.peterritchie.com/posts/Supporting%20Structured%20Dynamic%20Configuration%20in%20ASP.NET%20Core';

    if(publishedDate < fromJekyllDate)
    {
        disqus_url = disqus_url.replace('/posts', '');
        disqus_url = disqus_url + '/';
    }
    else
    {
        //var disqus_identifier = 'Supporting Structured Dynamic Configuration in ASP.NET Core';
    }
    console.info(disqus_identifier);

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
						</div>
					</section>
				
				</section>
				
				<!-- Footer -->
                <footer id="footer">
                    <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © Peter Ritchie&#x27;s Blog 2022
                        <br />
                            <a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by "Wyam"</a></strong>
                    </p>
                </div>
        </div>
</div>
                </footer>
			</div>

		<!-- Scripts -->
			<script src="/assets/js/skel.min.js"></script>
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/util.js"></script>
            <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
            <script src="/assets/js/main.js"></script>

	</body>

</html>