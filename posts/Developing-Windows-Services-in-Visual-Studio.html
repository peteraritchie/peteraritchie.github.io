
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Peter Ritchie&#x27;s Blog - Developing Windows Services in Visual Studio</title>
        <meta name="description" content="Peter Ritchie" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.xml" />
                <link type="application/atom+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-tooltip" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Peter Ritchie&#x27;s Blog - Developing Windows Services in Visual Studio" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://blog.peterritchie.com/posts/Developing-Windows-Services-in-Visual-Studio" />
        <!-- TODO: More social graph meta tags -->

        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Peter Ritchie&#x27;s Blog</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/testing">Testing</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Developing Windows Services in Visual Studio</h1>
    <div class="meta">        
Published on Wednesday, February 9, 2011<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/tags/DevCenterPost" class="btn btn-default btn-xs">DevCenterPost</a>
                    <a role="button" href="/tags/February-2011" class="btn btn-default btn-xs">February 2011</a>
                    <a role="button" href="/tags/Software-Development" class="btn btn-default btn-xs">Software Development</a>
                    <a role="button" href="/tags/Software-Development-Guidance" class="btn btn-default btn-xs">Software Development Guidance</a>
                    <a role="button" href="/tags/Visual-Studio-2010" class="btn btn-default btn-xs">Visual Studio 2010</a>
                    <a role="button" href="/tags/msmvps" class="btn btn-default btn-xs">msmvps</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p><a href="http://blogs.msmvps.com/peterritchie/2011/02/09/developing-windows-services-in-visual-studio/" title="Permalink to Developing Windows Services in Visual Studio">Source</a></p>
<h1 id="developing-windows-services-in-visual-studio">Developing Windows Services in Visual Studio</h1>
<p>Inevitably distributed systems often need a Windows service or two for certain tasks. The <a href="http://bitly.com/g4l2UA">creation of a Windows service project and hooking up a project installer</a> to the service is fairly straightforward; so, I'm not going to get into much detail about that stuff.</p>
<p>The stuff that I find that isn't well understood is how to debug and deploy these services in a development environment.</p>
<p>First off, debugging. A service is just an executable that is started up by the Windows service manager. From a native application standpoint, it has some entry points in it that the service manager looks for and invokes. From a managed standpoint, it's basically an object that is instantiated and given to System.ServiceProcess.ServiceBase.Run to get the service running. Of course, the actual execution of service must be in the context of the service manager in order for ServiceBase to hook into it an tell it what to do. So, simply running a service EXE will spit out a message about not being able to be run from the command-line or a debugger. Ugh, shot down pretty quickly.</p>
<p>In it's default state, you can simply install the service, start it, and attach a debugger to it (<a href="http://bitly.com/hIZu9w">http://bitly.com/hIZu9w</a>). This, of course, is a pain if what you want to debug doesn't need to be running in the service manager context. What I've been doing with services for quite a while now is use a simple trick of deciding in Main whether to call ServiceBase or call my OnStart override directly. This is based on tips like <a href="http://www.codeproject.com/KB/dotnet/DebugWinServices.aspx">http://www.codeproject.com/KB/dotnet/DebugWinServices.aspx</a> or <a href="http://stackoverflow.com/questions/125964/easier-way-to-start-debugging-a-windows-service-in-c">http://stackoverflow.com/questions/125964/easier-way-to-start-debugging-a-windows-service-in-c</a></p>
<p>This little trick is basically adding a couple of lines to Main, and a couple of methods to your ServiceBase-derived class and you're done! In your ServiceBase class, add two methods: InteractiveStart and InteractiveStop. Each of these methods simply call OnStart and OnStop, respectively. OnStart and OnStop are protected overrides, so the InteractiveStart and InteractiveStop let us gain access to them from outside the class. For example:</p>
<pre><code>publicpartialclassMonitoringService : ServiceBase {
	public MonitoringService() {
		InitializeComponent();
	}
 
	protectedoverridevoid OnStart(string[] args) {
		// complex multi-threaded code removed for clarity 😉
	}
 
	protectedoverridevoid OnStop() {
	}
 
**	publicvoid InteractiveStart() {
		OnStart(null);
	}
 
	publicvoid InteractiveStop() {
		OnStop();
	}**
}
</code></pre>
<p>In Main, we simply check Environment.UserInteractive and call InteractiveStart and InteractiveStop. For example:</p>
<pre><code>staticvoid Main() {
	var service = newMonitoringService();
	if (Environment.UserInteractive) {
		service.InteractiveStart();
		Console.WriteLine(&quot;service running. Press enter to exit&quot;);
		Console.ReadLine();		
		service.InteractiveStop();
		return;
	}
	ServiceBase.Run(service);
}
</code></pre>
<p>Probably a net gain of about seven lines of code.</p>
<p>To get this to work, you have to change your Windows service project's settings from Windows Application to Console Application. You can now set a breakpoint in your service code and press F5.</p>
<p>This technique requires none of your service code to change, and you can wire off the code with a simple #if defined(…) if you like for Release builds.</p>
<p>Now that life's easier with the ability to easily debug a Windows service; what about where you want to debug something else that uses the service in a running state? You could simply run the EXE so that it runs in our interactive mode and run the other application so it can interact with it. But, sometimes you actually need to be running it as a service (e.g. you need the app to be running in a certain user context). You can use your deployment project and install the service, type in username and password information and then run your other application. But, having to do this more than a couple of times becomes tedious very fast. Luckily, the Framework's InstallUtil has you covered there. You may be familiar with InstallUtil's ability to install and uninstall services from the command line (&quot;InstallUtil MonitoringService1.exe&quot; to install and &quot;InstallUtil /u MonitoringService.exe&quot; to uninstall). But, With the help of ServiceProcessInstaller added by the designer, InstallUtil also let's you provide a username and password for when your services is configured in the service process installer for ServiceAccount.User. It's a simple matter of using username and password service parameters. For example:</p>
<p>installutil /username=&quot;.MonitorServiceAccount&quot; &quot; MonitoringService.exe</p>
<p>Try &quot;installUtil MyService.exe /?&quot; sometime to see all the options available to you, including password and username, ala <em>Additional Installer Options</em> at <a href="http://bitly.com/hNsK1R" title="http://bitly.com/hNsK1R ">http://bitly.com/hNsK1R </a></p>
<p>Of course, you have to run these from a command line in Administrative mode if you're using Vista/7/2008 and need to make sure the account has rights to_ run as a service_.</p>
<p>You can even create a batch file to install and start the service. For example:</p>
<p>installutil /username=&quot;.MonitorServiceAccount&quot; /password=&quot;SuperSecretP&#64;55w0rd&quot; WindowsService1.exe<br />
net start MonitoringService</p>
<p>Hope this helps!</p>
<p>[EDIT: added the Console.ReadLine mentioned by Stefan]</p>


<div id="disqus_thread"></div>  
<!--
    'Developing-Windows-Services-in-Visual-Studio'
    'Developing Windows Services in Visual Studio'
    'http://blog.peterritchie.com/posts/Developing-Windows-Services-in-Visual-Studio'
-->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    var fromJekyllDate = new Date('Wed Feb 01 2022');
    var publishedDate = new Date('2/9/11');
    console.info('Developing-Windows-Services-in-Visual-Studio');

    var disqus_identifier = '';
    var disqus_shortname = 'peterritchiesblog'; // required: replace example with your forum shortname
    var disqus_title = 'Developing Windows Services in Visual Studio';
    var disqus_url = 'http://blog.peterritchie.com/posts/Developing-Windows-Services-in-Visual-Studio';

    if(publishedDate < fromJekyllDate)
    {
        disqus_url = disqus_url.replace('/posts', '');
        disqus_url = disqus_url + '/';
    }
    else
    {
        //var disqus_identifier = 'Developing-Windows-Services-in-Visual-Studio';
    }
    console.info(disqus_identifier);

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © Peter Ritchie&#x27;s Blog 2025
                        <br />
                            <a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by "Wyam"</a></strong>
                        <br/>
                        <a rel="me" href="https://mastodon.social/@peterritchie">Mastodon.social</a>&nbsp;|&nbsp;<a rel="me" href="https://fosstodon.org/@peterritchie">fosstodon.org</a>&nbsp;|&nbsp;<a rel="me" href="https://twitter.com/peterritchie">Twitter</a>&nbsp;|&nbsp;<a rel="me" href="https://www.linkedin.com/in/peteraritchie/">LinkedIn</a>&nbsp;|&nbsp;<a rel="me" href="https://bsky.app/profile/peterritchie.com">Bluesky</a>
                    </p>
                </div>
        </div>
</div>
                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/Please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

