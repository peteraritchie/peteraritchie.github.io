
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Peter Ritchie&#x27;s Blog - Identity Obsession and Domain-Driven Design</title>
        <meta name="description" content="Peter Ritchie" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.xml" />
                <link type="application/atom+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-tooltip" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Peter Ritchie&#x27;s Blog - Identity Obsession and Domain-Driven Design" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://blog.peterritchie.com/posts/identity-obsession-and-domain-driven-design" />
        <!-- TODO: More social graph meta tags -->

        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Peter Ritchie&#x27;s Blog</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>
        <li><a href="/testing">Testing</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Identity Obsession and Domain-Driven Design</h1>
    <div class="meta">        
Published on Thursday, September 26, 2024<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/NET" class="btn btn-default btn-xs">.NET</a>
                    <a role="button" href="/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/tags/DDD" class="btn btn-default btn-xs">DDD</a>
                    <a role="button" href="/tags/Domain-Driven-Design" class="btn btn-default btn-xs">Domain-Driven Design</a>
                    <a role="button" href="/tags/Identity" class="btn btn-default btn-xs">Identity</a>
                    <a role="button" href="/tags/Sept-2024" class="btn btn-default btn-xs">Sept 2024</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p><img src="../assets/mind-map.png" class="img-fluid" alt="Complicated translation" /></p>
<p>Domain-Driven Design builds on established ontological concepts like Identity, Entities, and characteristics. Entities in either context are constructs with <em>Identity</em>. Entities are recognizable instances of higher-level classifications. Entities are recognized not just by their characteristics or qualities. Ontologically, an Entity's Identity can be numerical <em>or</em> philosophical. In software, explicit Identity is always implemented <em>numerically</em> (that is, an Identifier that is compared by value.) In either context, Identity can be <em>implicit</em> or <em>explicit</em>, too often explicit in software.</p>
<p>Domain-Driven Design categorizes Identity as either <em>global</em> or <em>local</em>. I have found that too often, only global Identity is implemented or recognized—which may be due to the explicitness of global Identity. I have also observed the over-use of Identity (explicit and global.) I'm calling this phenomenon &quot;Identity Obsession,&quot; I'll explain it by comparing it to what helped inspire it: Primitive Obsession.</p>
<p>There's a code smell called Primitive Obsession<sup>[<a href="https://amzn.to/3Y05vTq">Refactoring</a>]</sup>, where domain-specific concepts are implemented in object-oriented languages as primitive (or built-in) types instead of custom types. Domain concepts are domain concepts because they are unique to a domain, so it's unlikely they would be on parity with anything in another, independent, domain; especially a technical concept like an <code>int</code> or a <code>string</code>. Primitive Obsession exists to help recognize that a custom type is necessary embody unique constraints over and above any implementation details of a primitive type.</p>
<p>Like Primitive Obsession, <em>Identity Obsession</em> occurs due to the influence of implementation details. In the case of Identity Obsession, those implementation details are typically <em>the possibility</em> of an RDBMS being involved.</p>
<p>But first, let's align on <em>Identity</em> in Domain-Driven Design. Something has an Identity when you can differentiate it from something beyond its qualities or attributes. The obsession is that <em>implemented</em> Domain Objects are given a globally unique Identifier (as opposed to locally unique) that habitually manifests as an <code>Id</code> property on the Domain Object's implementation. It's not uncommon for me to see <em>modeled</em> Domain Objects (i.e., abstract concepts) given a globally unique Identifier attribute—that is, modeled to include a value with unique characteristics (auto-incrementing or universally unique) at a time when implementation details are yet to be considered.</p>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Identity Obsession</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">All Entities are modeled with an Identifier and all implemented Entities have a public <code>Id</code> property whether they are necessary or not</td>
</tr>
</tbody>
</table>
<p>It's important to remember that one, Domain Objects can be differentiated from one another by more than an assignable property, and two, Domain Objects may have more than one Identity. Arguably, not all Identities are that of the <em>Domain Object</em> (and others are the Identity of a DTO or the database row), but that's another symptom of the obsession. Let's look at a Domain Identity.</p>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">An Entity doesn't need to differentiate itself from another instance of an Entity, it knows who it is</td>
</tr>
</tbody>
</table>
<p>In many domains, an Entity called &quot;Account&quot; exists. Abstractly, it has a Domain-specific Identity used within the domain to identify one physical account from another. The type and value of that Identifier depends on the domain—typically, it's textual and has format/structure rules. Social Security Numbers, for example, have a textual structure of <code>123-45-6789</code> (&quot;textual&quot;, not &quot;string&quot; to avoid Primitive Obsession).</p>
<p>A Domain-specific Identity is a part of the Domain whether there are technical implementations related to that Domain or not. Upon recognition or observance of that Identity, it becomes part of the Ubiquitous Language and independent of implementation details and constraints. The Identifier of the Domain Identity is sometimes not used as the implemented Identifier. That Identifier value has unique characteristics in technical solutions within the Domain, but that doesn't mean that the Domain Identifier is also the technical solution's unique Identifier. When implementing storage, there are many reasons why I don't want the Domain Identifier to be the <em>primary key</em> and I would choose another value and probably a different primitive type for the implementation, like a UUID/GUID. Similarly, when implementing an API, I may not want to use an SSN within a URI or the primary key from the storage implementation. In this case, there are three <em>concrete Identifiers</em> for the one abstract concept.</p>
<p>Both Entities and Value Objects can have Identity. As Domain-Driven Design practitioners, it's ingrained in us that an Entity has Identity and that often manifests as an <code>Id</code> property on an Entity implementation. But it shouldn't be that way. As a <em>global</em> Identity, it should not be managed by the Entity to which it is assigned. The Identity is meaningless within the implementation class of an Entity. Identity is a higher-level concept from the concept it applies to. Something needs to manifest an <em>Identifier</em> and an Entity must be consistent upon creation, so the Entity itself cannot be responsible for creating its own Identifier. The <em>Identifier</em> is in fact an implementation detail. Management of that Identifier is typically the responsibility of a service, often a Repository service since that's when global Identity is required.</p>
<p>An Entity that requires an Identifier upon creation (and to thus be always consistent) in an object oriented language needs that Identifier to be passed in during construction or calculated within the Entity during construction. In the first scenario, instantiation of an Entity is now coupled to something responsible for the generation of Identifiers.  In the second scenario the Entity implementation has taken on too much responsibility. At best case it implements an algorithm for generating a globally unique Identifier.  At worst case it has to take on responsibility of the Identity semantics, like rules, validation, etc. Let's look at a naive example of an Entity that uses an SSN as an Identifier;</p>
<pre><code class="language-csharp">public class Client : Person
{
    public Client(string givenName, string familyName, Ssn ssn)
        : base(givenName, familyName)
    {
        Ssn = ssn;
    }
    public Client(string givenName, string familyName, ISsnGenerator ssnGenerator)
        : base(givenName, familyName)
    {
        Ssn = ssnGenerator.Generate();
    }

    public Ssn Ssn { get; }
}
//...
public interface IClientRepository
{
    void Save(Client client);
    Result&lt;Client&gt; FindBySsn(Ssn ssn);
}
</code></pre>
<p>Constructing a <code>Client</code> instance is problematic with either of these constructors. One problem is the life of an SSN. What if an instantiation of a Client doesn't need to be persisted or is destroyed before it gets persisted? SSNs are a limited resource and need to be accounted for. We can't reserve one by generating it and not release it if it never gets used. We <em>could</em> expand on this to include something silly like an <code>ISsnManager</code> but now <code>Client</code> needs to understand when it does or does not get persisted. This can't accommodate exceptional situations where a <code>Client</code> instance is destroyed without warning. This implemented behavior is equivalent of a domain that allows residents of the USA to create and assign their own SSNs. Can you imagine the problems this would create? One may say that this is unique to SSNs and you wouldn't have this problem with <code>Guid</code>s. This is a naive point of view due to a perception that it's safe to throw away GUID values due to an implementation detail. There are multiple race conditions between when an new <code>Client</code> exists and when they are persisted to the system. Because of that reality, and that Repositories aren't Factories, the only solution is the <code>Client</code> class not to have an SSN property:</p>
<pre><code class="language-csharp">public class Client(string givenName, string familyName)
    : Person(givenName, familyName);
//...
public interface IClientRepository
{
    Result&lt;Ssn&gt; Save(Client client);
    Result&lt;Client&gt; FindBySsn(Ssn ssn);
}
</code></pre>
<p>With this implementation, SSN generation is deferred until a <code>Client</code> is persisted in the system. If the destruction of a <code>Client</code> occurs before being persisted, the system generates no SSN, and the release of the SSN is no longer an issue. The implementation of SSN generation and persistence still needs to account for failure, but that can handled <em>transactionally</em> and that responsibility can live where it belongs, outside of the Domain. SSN generation is still a domain concept, but how an allocated value is transactionally assigned is an implementation detail of the chosen infrastructure.</p>
<p>This implement doesn't impose SSN be a primary key, this implementation simply recognizes SSN as a Domain Identifier. Implementation details within the infrastructure are free to use another Identifier for a primary key—if that applies at all in the chosen infrastructure.</p>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Nested objects implicitly have Identifiers that are field or property names.</td>
</tr>
</tbody>
</table>
<h2 id="implicit-local-domain-identifiers">Implicit Local Domain Identifiers</h2>
<p>Another aspect of Identity Obsession is the failure to recognize implicit local Identity, which is most common with Aggregates. The idea behind Aggregates is that it is a group of Domain Objects considered a unit with unit-wide consistency requirements. Similar to our Client SSN example, because an Aggregate is a consistency boundary, operations on the Aggregate become part of a <em>transaction</em>. Entities composed within an Aggregate are implementation details accessible only through the interface provided by the Aggregate. Those Entities are owned by the Aggregate, meaning the Aggregate controls their lifecycle, including their construction and assignment of an Identifier. The transaction race conditions also arise with Aggregates: global Identifiers are meaningless until the Aggregate is persisted. That is, an Entity with global Identity made available as a property of an Aggregate is problematic due to those race conditions I mentioned earlier. You can't reliably realize global Identity until the Aggregate is persisted, but the Aggregate still needs to differentiate all the Domain Objects it owns. This means owned Domain Objects have <em>local Identity</em>.</p>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Because the Entities within an Aggregate are an implementation detail, Entities within the Aggregate have Identity local to the Aggregate</td>
</tr>
</tbody>
</table>
<p>The Aggregate still needs to differentiate the objects it owns, properties, fields, or indexes are <em>implicitly</em> the Identifiers of Entities assigned to them, <em>local</em> to the Aggregate. Imagine the quintessential e-commerce Domain that has order and order line Domain Objects. In this domain, order lines have no meaning outside of an order. For example:</p>
<pre><code class="language-csharp">public void CreateDeveloperToolsOrder(IOrderRepository repository)
{
    var order = new Order();
    order.AddItem(&quot;Visual Studio 2022&quot;, 667.00m);
    order.AddItem(&quot;ReSharper&quot;, 1, 139.00m);
    order.AddItem(&quot;NDepend&quot;, 1, 492.00m);
    order.AddItem(&quot;LINQPad&quot;, 1, 65.00m);
    var firstItem = order.OrderLines.ElementAt(0);
    order.RemoveItem(0);
    var orderNumber = repository.Save(order);
}
</code></pre>
<!--|Note|
|:-:|
|Entities owned by an Aggregate must appear like Value Objects within the interface of the Aggregate|-->
<p>The resulting <code>Order</code> instance comprises three <code>OrderLine</code> Entities. <code>OrderLine</code> Identity is the index of that instance in the <code>OrderLines</code> collection—a local identity. Until the call to <code>RemoveItem</code>, the Identity of the <code>Visual Studio Professional 2022</code> order line was <code>0</code>. Since <code>Visual Studio Professional 2022</code> was removed before <code>Save</code> was invoked, the local Identifier of <code>0</code> was the only Identifier that was ever required of it. Since order item Identity is local to an order, <code>OrderItem</code> implements no Identity:</p>
<pre><code class="language-csharp">public record OrderLine(string ProductName, float Quantity, decimal Price)
{
    public float Quantity { get; private set; } = Quantity;
    public decimal Price { get; private set; } = Price;
    public string ProductName { get; private set; } = ProductName;

    public void ChangePrice(decimal price)
    {
        Price = price;
    }
    public void ChangeQuantity(float quantity)
    {
        Quantity = quantity;
    }
}
</code></pre>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Global Identifiers required only for persistence should be an implementation detail of the Repository, not the Entity.</td>
</tr>
</tbody>
</table>
<h2 id="recognizing-identity-obsession">Recognizing Identity Obsession</h2>
<h3 id="domain-objects-described-with-an-id-characteristic-or-attribute">Domain Objects Described With an “ID” Characteristic or Attribute</h3>
<p>I have found it rare that Domain Identity manifests as a concept named &quot;ID.&quot; For example, an <em>account</em> typically has an Account Number Identifier, not an &quot;ID&quot; in banking. The Account Number <em>is</em> an &quot;ID&quot;, but the Domain does not use that term (and should not be part of the Ubiquitous Language.) If you run across descriptions of Domain Objects that use the term &quot;ID&quot; or &quot;Id&quot; you can avoid or remedy Identity Obsession by asking the Domain experts questions to get clarity.</p>
<h3 id="entities-implemented-with-an-id-property">Entities implemented with an <code>Id</code> property</h3>
<p>Entity implementations may include an <code>Id</code> property if descriptions of the underlying Domain Object include an &quot;ID&quot; characteristic or attribute. If the underlying Domain Object description does not include an &quot;ID&quot; attribute and the Entity implementation has an <code>Id</code> property, you've probably discovered Identity Obsession. The Entity implementation should mirror the Domain Object's Identity terminology. If it's unclear, asking questions of the Domain experts will result in clarity.</p>
<h2 id="take-aways">Take Aways</h2>
<table class="table">
<thead>
<tr>
<th style="text-align: center;">Take Away</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Isolate Identity and Identifiers from Entities</td>
</tr>
</tbody>
</table>
<p>Identity Obsession is the compulsion that every Domain Entity is described and implemented with a global Identifier. Global Identifiers are too frequently an implementation detail relating to a relational database. You can improve the implementation and gain deeper insight into the Domain by classifying Identities and treating them as independent Domain concepts. Identity as a separate domain concept enables you to isolate Identity and Identifiers from Entities so that an Entity is standalone and not complicated by the constraints of Identity.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://wiki.c2.com/?PrimitiveObsession">Primitive Obsession</a></li>
<li><a href="https://amzn.to/3Y05vTq">Refactoring: Improving the Design of Existing Code</a></li>
</ul>


<div id="disqus_thread"></div>  
<!--
    'identity-obsession-and-domain-driven-design'
    'Identity Obsession and Domain-Driven Design'
    'http://blog.peterritchie.com/posts/identity-obsession-and-domain-driven-design'
-->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    var fromJekyllDate = new Date('Wed Feb 01 2022');
    var publishedDate = new Date('9/26/24');
    console.info('identity-obsession-and-domain-driven-design');

    var disqus_identifier = '';
    var disqus_shortname = 'peterritchiesblog'; // required: replace example with your forum shortname
    var disqus_title = 'Identity Obsession and Domain-Driven Design';
    var disqus_url = 'http://blog.peterritchie.com/posts/identity-obsession-and-domain-driven-design';

    if(publishedDate < fromJekyllDate)
    {
        disqus_url = disqus_url.replace('/posts', '');
        disqus_url = disqus_url + '/';
    }
    else
    {
        //var disqus_identifier = 'identity-obsession-and-domain-driven-design';
    }
    console.info(disqus_identifier);

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © Peter Ritchie&#x27;s Blog 2025
                        <br />
                            <a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by "Wyam"</a></strong>
                        <br/>
                        <a rel="me" href="https://mastodon.social/@peterritchie">Mastodon.social</a>&nbsp;|&nbsp;<a rel="me" href="https://fosstodon.org/@peterritchie">fosstodon.org</a>&nbsp;|&nbsp;<a rel="me" href="https://twitter.com/peterritchie">Twitter</a>&nbsp;|&nbsp;<a rel="me" href="https://www.linkedin.com/in/peteraritchie/">LinkedIn</a>&nbsp;|&nbsp;<a rel="me" href="https://bsky.app/profile/peterritchie.com">Bluesky</a>
                    </p>
                </div>
        </div>
</div>
                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/Please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

