
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Peter Ritchie&#x27;s Blog - Thoughts on Web Services, REST APIs, and Message Structure</title>
        <meta name="description" content="Peter Ritchie" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.xml" />
                <link type="application/atom+xml" rel="alternate" title="Peter Ritchie&#x27;s Blog" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-tooltip" content="Peter Ritchie&#x27;s Blog" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Peter Ritchie&#x27;s Blog - Thoughts on Web Services, REST APIs, and Message Structure" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://blog.peterritchie.com/posts/Thoughts-Web-Services--REST-APIs--and-Message-Structure" />
        <!-- TODO: More social graph meta tags -->

        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Peter Ritchie&#x27;s Blog</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/about">About</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Thoughts on Web Services, REST APIs, and Message Structure</h1>
    <div class="meta">        
Published on Tuesday, April 9, 2019<br>    </div>
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h2 id="part-1-http">Part 1: HTTP</h2>
<p>Love it or hate it, HTTP is ubiquitous.  It's been around for thirty years.
It has evolved alot in those thirty years.  One critical way it has evolved is
to support flexibility. Despite the huge benefits of that flexibility it can
and has lead people away from recommended and expected usage and patterns.</p>
<p>&quot;No big deal&quot;, some say, but being lead away from recommended
usage leads to re-discovery and re-invention and an evolutionary way of
working (i.e. it's never right the first time).  This evolutionary process
is a constraining process, each step must be based on the last and all that
came before it.  That's great when you do have to invent something that never
existed; but when a solution already exists, this process needlessly
constrains progress sometimes to the point of missing the actual
recommendation or expectation.</p>
<p>The flexibility of HTTP really means that people have to have a deep or broad
knowledge of it to use it properly.  Take the <code>Accept</code> request header and
media types. It allows a requestor to limit and rank the possible content
format. We typically see this with at least XML and JSON nowadays.  To be
clear this means Web APIs can have different formats of responses. The
Content-Type header field means the inverse, that an API can accept multiple
request content formats.  As flexible as this is, different content formats
have at least some lack of parity of features.  As an example, XML has rich
syntax that includes things like full featured consistent schema definitions.
JSON is working towards things like that, but this is an example where the
two have different semantic structure.  There are things that can be done to
compensate, but at the end of the day neither was designed to work exactly like
the other (that's kinda the point, isn't it?)  This is just one example where
there's possibility of mismatch, mismatch in how two content formats can
represent the same thing.</p>
<p>You may be thinking, <em>where am I going this with</em>?  Thanks for the segue. What
this means is there will be times when you <em>change the structure or schema</em> of
content (request or response) <strong>because it's one type OR the other</strong>.  Which
leads me back towards media types.  If the schema of a JSON response
changes but the XML doesn't, what does <em>versioning</em> of APIs mean?  Well, it
means that because there are different formats of content is independently
changing schemas <strong>you cannot reliably the version an API by URI</strong>.  You can't even use a general
header field that applies to all content because a change to one could be
breaking but unnecessary or non-breaking in the other.  Making versioning
problematic at best.  This means you really <strong>must use media type as the
versioning mechanism</strong>. (&quot;MTATEOV&quot;: Media Type As The Engine of
Versionability?)</p>
<p>But, if you've ignored media types and effectively ignored schemas and cause
breaking changes because it just works and breaking changes have been
tolerable.  Of course, being in this situation and let the flexibility
herd you into this corner.  But, it really is fairly easy also ends up
solving these issues as well as open up some opportunities like Web Linking to
content type and version! Let's have a look at the standard format of the media type.</p>
<p>Media types consist of a <em>type</em> and a <em>subtype</em>, separated by a forward slash.<br />
For example &quot;application/xml&quot;, &quot;application/json&quot;.  The subtype is further
structured in a tree that provides many options.  There are standards subtypes
that are fixed or *standard&quot; like &quot;text/html&quot; and &quot;image/png&quot; which specify a
standard format.  The standards subtypes typically fall under types like
&quot;text&quot;, &quot;image&quot;, etc.</p>
<p>There can be application-specific subtypes and those fall under the
&quot;application&quot; type.  There is a bit of inconsistency in media types, like
JSON is &quot;application/json&quot; and XML is &quot;text/xml&quot; despite the two content
formats having standard structure and semantics.  But, I'll focus on
application-specific structures because you should only need to version
application-specific structures.</p>
<p>Despite application-specific, the application-specific parts can be built off
of those standard content structures like XML and JSON to create a custom
subset schema (so to speak).  Media type standard supports that including a
suffix and parameters to the subtype.  The subtype format is essentially
<code>subtype[&quot;+&quot; suffix] [*&quot;;&quot; parameter]</code> or &quot;subtype&quot; followed by an optional
suffix separated by &quot;+&quot; followed by one or more parameters separated by &quot;;&quot;.<br />
And each parameter may have an optional value separated by &quot;=&quot;.
So, I could specify that I have HTML text encoding as UTF-8 as
&quot;text/html; charset=UTF-8&quot; or I could specific an application-specific format
(like &quot;gibberish&quot;) that is based on XML like this &quot;application/gibberish+xml&quot;.</p>
<p>In order to avoid name clashes with other vendors, these media types are
expected to be in the Vendor Tree where standards types fall under the root or
Standards Tree.  Trees are specified with a prefix to the subtype, making
the standard structure of a subtype like this
<code>[tree &quot;.&quot;] subtype[&quot;+&quot; suffix] [*&quot;;&quot; parameter]</code>.  <em>tree</em> as the
structure of <code>tree *[&quot;.&quot; subtree]</code> meaning there can be many trees separated
by &quot;.&quot;.  The standard details that the Vendor Tree starts with the &quot;vnd.&quot;
prefix.  So, our custom type should really have the form
&quot;application/vnd.pri.gibberish+xml&quot;, where &quot;pri&quot; is a vendor-specific name or
identifier.  Or if JSON format is required: &quot;application/vnd.pri.gibberish+xml&quot;.</p>
<p>Now that we know about custom, vendor application-specific type identifiers,
on to dealing with changes to that content format that may introduce breaking
changes, or <em>versioning</em>.  Since we're dealing with vendor and application-
specific identifiers within <em>subtype</em> we deviate into an area not covered
specifically by a standard.  And you're basically free to do anything you want
to specify the version, some have a format like
&quot;application/vnd.pri.gibberish.v2+xml&quot;.  Some use a subtype parameter like
&quot;application/vnd.pri.gibberish+xml;v=2&quot; or
&quot;application/vnd.pri.gibberish+xml;version=2&quot;.  Since what lead us on
this particular journey was the problem of diverging versions between
underlying structures, the parameter route makes more sense because the
version really applies, in that case, to the content with an underlying
structure.  And being a parameter after the prefix, it's less like a version
of the subtype. e.g. &quot;application/vnd.pri.gibberish.v2+xml&quot; could be
interpreted as gibberish version 2 with an underlying XML structure.  But
&quot;application/vnd.pri.gibberish+xml;v=2&quot; is easier to interpret as
gibberish+xml version 2.</p>
<p>Side note: In the versions I've shown here I've not used a minor version
(like 2.1).  I did that on purpose based on SEMVER that stipulates major
version number increment to signify breaking changes.  Non-breaking changes
in content is achieved with optional values, so client requestors that
don't know the new optional values won't use them and thus minor version
doesn't matter.  Also, if new optional values appear in a response, the
requester shouldn't care either.  You can structure your schema to make such
that a requestor need to care about it, but that is a breaking change and a
major version increment, not a minor version increment.<!-- 2019, April--></p>


<div id="disqus_thread"></div>  
<!--
    'Thoughts-Web-Services--REST-APIs--and-Message-Structure'
    'Thoughts on Web Services, REST APIs, and Message Structure'
    'http://blog.peterritchie.com/posts/Thoughts-Web-Services--REST-APIs--and-Message-Structure'
-->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    var fromJekyllDate = new Date('Wed Feb 01 2022');
    var publishedDate = new Date('4/9/19');
    console.info('Thoughts-Web-Services--REST-APIs--and-Message-Structure');

    var disqus_identifier = '';
    var disqus_shortname = 'peterritchiesblog'; // required: replace example with your forum shortname
    var disqus_title = 'Thoughts on Web Services, REST APIs, and Message Structure';
    var disqus_url = 'http://blog.peterritchie.com/posts/Thoughts-Web-Services--REST-APIs--and-Message-Structure';

    if(publishedDate < fromJekyllDate)
    {
        disqus_url = disqus_url.replace('/posts', '');
        disqus_url = disqus_url + '/';
    }
    else
    {
        //var disqus_identifier = 'Thoughts-Web-Services--REST-APIs--and-Message-Structure';
    }
    console.info(disqus_identifier);

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12 text-center">
                    <p class="copyright text-muted">
                        Copyright © Peter Ritchie&#x27;s Blog 2025
                        <br />
                            <a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a>
                        |
                            <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <strong><a href="https://wyam.io">Generated by "Wyam"</a></strong>
                        <br/>
                        <a rel="me" href="https://mastodon.social/@peterritchie">Mastodon.social</a>&nbsp;|&nbsp;<a rel="me" href="https://fosstodon.org/@peterritchie">fosstodon.org</a>&nbsp;|&nbsp;<a rel="me" href="https://twitter.com/peterritchie">Twitter</a>&nbsp;|&nbsp;<a rel="me" href="https://www.linkedin.com/in/peteraritchie/">LinkedIn</a>&nbsp;|&nbsp;<a rel="me" href="https://bsky.app/profile/peterritchie.com">Bluesky</a>
                    </p>
                </div>
        </div>
</div>
                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/Please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

